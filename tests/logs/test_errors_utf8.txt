============================= test session starts =============================
platform win32 -- Python 3.11.9, pytest-9.0.2, pluggy-1.6.0 -- C:\Users\Sameer\OneDrive\Desktop\AI_Interview_Backend\.venv\Scripts\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Sameer\OneDrive\Desktop\AI_Interview_Backend
configfile: pytest.ini
plugins: anyio-4.12.1, langsmith-0.6.6, asyncio-1.3.0
asyncio: mode=Mode.AUTO, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 7 items

tests/unit/test_auth.py::test_register_user FAILED                       [ 14%]
tests/unit/test_auth.py::test_login_success PASSED                       [ 28%]
tests/unit/test_auth.py::test_login_failure PASSED                       [ 42%]
tests/unit/test_auth.py::test_get_me PASSED                              [ 57%]
tests/integration/test_auth_router.py::test_register_bootstrap_user FAILED [ 71%]
tests/integration/test_auth_router.py::test_login_success PASSED         [ 85%]
tests/integration/test_auth_router.py::test_login_failure PASSED         [100%]

================================== FAILURES ===================================
_____________________________ test_register_user ______________________________

session = <sqlmodel.orm.session.Session object at 0x00000229673EA510>
client = <starlette.testclient.TestClient object at 0x000002296A700110>

    def test_register_user(session, client):
        payload = {
            "email": "newuser@example.com",
            "full_name": "New User",
            "password": "password123",
            "role": "candidate"
        }
        response = client.post("/api/auth/register", json=payload)
>       assert response.status_code == 200
E       assert 403 == 200
E        +  where 403 = <Response [403 Forbidden]>.status_code

tests\unit\test_auth.py:9: AssertionError
________________________ test_register_bootstrap_user _________________________

client = <starlette.testclient.TestClient object at 0x000002296AAD3790>
session = <sqlmodel.orm.session.Session object at 0x000002296A726590>

    def test_register_bootstrap_user(client, session):
        # Arrange: DB is empty implicitly due to function scope
    
        response = client.post("/api/auth/register", json={
            "email": "admin@example.com",
            "password": "password123",
            "full_name": "Admin User",
            "role": "admin"
        })
    
>       assert response.status_code == 200  # HTTP status might still be 200 unless explicitly set
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       assert 403 == 200
E        +  where 403 = <Response [403 Forbidden]>.status_code

tests\integration\test_auth_router.py:17: AssertionError
=========================== short test summary info ===========================
FAILED tests/unit/test_auth.py::test_register_user - assert 403 == 200
FAILED tests/integration/test_auth_router.py::test_register_bootstrap_user - ...
========================= 2 failed, 5 passed in 2.13s =========================

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Interview Backend Demo</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; max-width: 600px; margin: 2rem auto; padding: 0 1rem; line-height: 1.5; }
        .card { border: 1px solid #ddd; border-radius: 8px; padding: 1.5rem; margin-bottom: 1rem; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        input { width: 100%; padding: 8px; margin: 5px 0 15px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box;}
        button { background: #0070f3; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; width: 100%; font-size: 16px; transition: background 0.2s; }
        button:hover { background: #0051a2; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 4px; overflow-x: auto; font-size: 13px; }
        .status { margin-top: 10px; padding: 10px; border-radius: 4px; display: none; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        h2 { margin-top: 0; }
    </style>
</head>
<body>
    <h1>üöÄ Backend Integration Demo</h1>
    <p>This page connects to your live API at <br><code>https://ichigo253-ai-interview-backend.hf.space</code></p>

    <div class="card">
        <h2>1. Test Connection</h2>
        <p>Check if the API is online (hits <code>/api/metadata</code> if available, or just root).</p>
        <button onclick="checkHealth()">Ping API</button>
        <div id="healthStatus" class="status"></div>
    </div>

    <div class="card">
        <h2>2. Login (Get Token)</h2>
        <label>Email</label>
        <input type="email" id="email" value="admin@example.com" placeholder="admin@example.com">
        
        <label>Password</label>
        <input type="password" id="password" value="password" placeholder="password">
        
        <button onclick="login()">Login</button>
        <div id="loginStatus" class="status"></div>
        <pre id="loginOutput"></pre>
    </div>

    <script>
        const API_URL = "https://ichigo253-ai-interview-backend.hf.space";
        // const API_URL = "http://localhost:8000"; // Uncomment to test locally

        async function checkHealth() {
            const statusDiv = document.getElementById('healthStatus');
            statusDiv.style.display = 'block';
            statusDiv.innerHTML = "Pinging...";
            statusDiv.className = 'status';

            try {
                // We'll hit the docs endpoint since it's publicly available and reliable
                const res = await fetch(`${API_URL}/docs`, { method: 'HEAD' });
                if (res.ok) {
                    statusDiv.innerHTML = "‚úÖ API is Online!";
                    statusDiv.classList.add('success');
                } else {
                    throw new Error(res.statusText);
                }
            } catch (err) {
                statusDiv.innerHTML = "‚ùå Connection Failed. <br><small>Did you configure CORS?</small>";
                statusDiv.classList.add('error');
                console.error(err);
            }
        }

        async function login() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const output = document.getElementById('loginOutput');
            const statusDiv = document.getElementById('loginStatus');

            statusDiv.style.display = 'none';
            output.innerText = "Loading...";

            try {
                const res = await fetch(`${API_URL}/api/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                const data = await res.json();
                output.innerText = JSON.stringify(data, null, 2);

                if (res.ok && data.success) {
                    statusDiv.innerHTML = "‚úÖ Login Successful!";
                    statusDiv.className = 'status success';
                    statusDiv.style.display = 'block';
                } else {
                    throw new Error(data.message || "Login failed");
                }
            } catch (err) {
                statusDiv.innerHTML = `‚ùå Error: ${err.message}`;
                statusDiv.className = 'status error';
                statusDiv.style.display = 'block';
                output.innerText = "";
            }
        }
    </script>
</body>
</html>
